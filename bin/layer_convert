#!/usr/bin/env ruby
# frozen_string_literal: true

require 'fileutils'

require_relative '../lib/twenty48'
include Twenty48

ARGV.each do |bin_pathname|
  puts bin_pathname
  raise "bad: #{bin_pathname}" unless File.extname(bin_pathname) == '.bin'
  stem = File.join(
    File.dirname(bin_pathname),
    File.basename(bin_pathname, '.bin')
  )
  vbyte_pathname = "#{stem}.vbyte"
  info_pathname = "#{stem}.json"

  num_states = File.stat(bin_pathname).size / 8
  puts "num_states: #{num_states}"

  File.open(info_pathname, 'w') do |info_file|
    JSON.dump({
      num_states: num_states
    }, info_file)
  end

  convert_bin_layer_to_vbyte bin_pathname, vbyte_pathname
end
